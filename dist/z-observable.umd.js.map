{"version":3,"file":"lz-observable.umd.js","sources":["../src/util.ts","../src/Observable.ts"],"sourcesContent":["export const  getDataType  = (data: any): string =>{\n  return Object.prototype.toString.call(data).toLowerCase();\n}\n\n\nexport const isFunction = (data: any): boolean => getDataType(data) === '[object function]';\nexport const isObject = (data: any): boolean => getDataType(data) === '[object object]';\n","// Import here Polyfills if needed. Recommended core-js (npm i -D core-js)\n// import \"core-js/fn/array.find\"\n// ...\nimport { isFunction } from './util'\n\ninterface ObserverInterface {\n  next: Function\n  complete: Function\n  error: Function\n  nextCb: Function[]\n  addNext: Function\n  clearNext: Function\n}\n\ninterface ObserverDataInterface {\n  next: Function\n  complete?: Function\n  error?: Function\n  // ? error: Function\n}\n\nclass Observer implements ObserverInterface {\n  nextCb: Function[]\n  completeCb: Function | null\n  errorCb: Function | null\n  constructor() {\n    this.nextCb = []\n    this.completeCb = null\n    this.errorCb = null\n  }\n\n  next = (data: any) => {\n    // console.log('next', data);\n    if (this.nextCb.length) {\n      this.nextCb.forEach(item => {\n        item(data)\n      })\n    }\n  }\n\n  complete = () => {\n    this.completeCb && this.completeCb()\n  }\n\n  error = (func: Function, observer: Observer | null) => {\n    this.errorCb && this.errorCb()\n  }\n\n  addNext = (func: Function) => {\n    this.nextCb.push(func)\n  }\n  clearNext = () => {\n    this.nextCb = []\n  }\n  addComplete = (func: Function, observer: Observer | null) => {\n    this.completeCb = () => {\n      func()\n      this.clearAll();\n      observer = null\n    }\n  }\n  addError = (func: Function, observer: Observer | null) => {\n    this.errorCb = () => {\n      func()\n      this.clearAll();\n      observer = null\n    }\n  }\n  clearAll = () => {\n    this.completeCb = null\n    this.errorCb = null\n    this.clearNext()\n  }\n}\n\nclass Observable {\n  initFunc: Function\n  constructor(observFunc: Function) {\n    // this.test = subscriber();\n    if (!isFunction(observFunc)) {\n      throw Error('必须有初始化函数')\n    }\n    // this.test = new MyTest();\n    this.initFunc = (observer: Observer) => {\n      observFunc(observer)\n    }\n    return this\n  }\n  public subscribe = (subObj: ObserverDataInterface) => {\n    let observer: Observer | null = new Observer()\n\n    if (subObj.next && isFunction(subObj.next)) {\n      // this.nextCb.push(subObj.next);\n      observer.addNext(subObj.next)\n    }\n    if (subObj.complete && isFunction(subObj.complete)) {\n      // this.nextCb.push(subObj.next);\n      observer.addComplete(subObj.complete, observer)\n    }\n\n    if (subObj.error && isFunction(subObj.error)) {\n      // this.nextCb.push(subObj.next);\n      observer.addError(subObj.error, observer)\n    }\n    // this.test.run();\n    this.initFunc(observer)\n  }\n}\n\nexport default Observable\n"],"names":[],"mappings":"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"}
