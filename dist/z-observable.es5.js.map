{"version":3,"file":"lz-observable.es5.js","sources":["../src/util.ts","../src/Observable.ts"],"sourcesContent":["export const  getDataType  = (data: any): string =>{\n  return Object.prototype.toString.call(data).toLowerCase();\n}\n\n\nexport const isFunction = (data: any): boolean => getDataType(data) === '[object function]';\nexport const isObject = (data: any): boolean => getDataType(data) === '[object object]';\n","// Import here Polyfills if needed. Recommended core-js (npm i -D core-js)\n// import \"core-js/fn/array.find\"\n// ...\nimport { isFunction } from './util'\n\ninterface ObserverInterface {\n  next: Function\n  complete: Function\n  error: Function\n  nextCb: Function[]\n  addNext: Function\n  clearNext: Function\n}\n\ninterface ObserverDataInterface {\n  next: Function\n  complete?: Function\n  error?: Function\n  // ? error: Function\n}\n\nclass Observer implements ObserverInterface {\n  nextCb: Function[]\n  completeCb: Function | null\n  errorCb: Function | null\n  constructor() {\n    this.nextCb = []\n    this.completeCb = null\n    this.errorCb = null\n  }\n\n  next = (data: any) => {\n    // console.log('next', data);\n    if (this.nextCb.length) {\n      this.nextCb.forEach(item => {\n        item(data)\n      })\n    }\n  }\n\n  complete = () => {\n    this.completeCb && this.completeCb()\n  }\n\n  error = (func: Function, observer: Observer | null) => {\n    this.errorCb && this.errorCb()\n  }\n\n  addNext = (func: Function) => {\n    this.nextCb.push(func)\n  }\n  clearNext = () => {\n    this.nextCb = []\n  }\n  addComplete = (func: Function, observer: Observer | null) => {\n    this.completeCb = () => {\n      func()\n      this.clearAll();\n      observer = null\n    }\n  }\n  addError = (func: Function, observer: Observer | null) => {\n    this.errorCb = () => {\n      func()\n      this.clearAll();\n      observer = null\n    }\n  }\n  clearAll = () => {\n    this.completeCb = null\n    this.errorCb = null\n    this.clearNext()\n  }\n}\n\nclass Observable {\n  initFunc: Function\n  constructor(observFunc: Function) {\n    // this.test = subscriber();\n    if (!isFunction(observFunc)) {\n      throw Error('必须有初始化函数')\n    }\n    // this.test = new MyTest();\n    this.initFunc = (observer: Observer) => {\n      observFunc(observer)\n    }\n    return this\n  }\n  public subscribe = (subObj: ObserverDataInterface) => {\n    let observer: Observer | null = new Observer()\n\n    if (subObj.next && isFunction(subObj.next)) {\n      // this.nextCb.push(subObj.next);\n      observer.addNext(subObj.next)\n    }\n    if (subObj.complete && isFunction(subObj.complete)) {\n      // this.nextCb.push(subObj.next);\n      observer.addComplete(subObj.complete, observer)\n    }\n\n    if (subObj.error && isFunction(subObj.error)) {\n      // this.nextCb.push(subObj.next);\n      observer.addError(subObj.error, observer)\n    }\n    // this.test.run();\n    this.initFunc(observer)\n  }\n}\n\nexport default Observable\n"],"names":[],"mappings":"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"}
